<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes"
    />
    <title>MedPresc ¬∑ Dark dashboard</title>
    <style>
      /* ----- DARK MODE GLOBAL ----- */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family:
          'Inter',
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          'Segoe UI',
          Roboto,
          sans-serif;
      }

      body {
        background-color: #0a0c0f;
        color: #e5e7eb;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* App layout with sidebar */
      .app-wrapper {
        display: flex;
        min-height: 100vh;
        position: relative;
      }

      /* Sidebar - modern glass panel */
      .sidebar {
        width: 280px;
        background: #0f141c;
        border-right: 1px solid #262f3c;
        padding: 2rem 1.2rem;
        display: flex;
        flex-direction: column;
        transition: transform 0.3s ease;
        backdrop-filter: blur(10px);
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
        z-index: 100;
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
      }

      .sidebar.collapsed {
        transform: translateX(-100%);
        position: fixed;
      }

      .sidebar-header {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        margin-bottom: 2.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #263040;
      }

      .sidebar-logo {
        background: #2271c2;
        width: 40px;
        height: 40px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
      }

      .sidebar-header h2 {
        font-size: 1.4rem;
        font-weight: 600;
        background: linear-gradient(135deg, #e2e9ff, #99b8f0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .user-profile {
        background: #1a222f;
        border-radius: 1.5rem;
        padding: 1.2rem 1rem;
        margin-bottom: 2rem;
        border: 1px solid #314153;
        text-align: center;
      }

      .user-avatar {
        width: 60px;
        height: 60px;
        background: #2d405b;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin: 0 auto 0.8rem;
        border: 2px solid #3f5f8f;
      }

      .user-name {
        font-weight: 600;
        color: #e1ecff;
        word-break: break-word;
      }

      .user-email {
        font-size: 0.8rem;
        color: #8fa6cf;
        margin: 0.3rem 0 0.8rem;
        word-break: break-word;
      }

      /* Stats cards */
      .stats-section {
        margin-bottom: 2rem;
      }

      .stats-title {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #7890b5;
        margin-bottom: 1rem;
      }

      .stat-card {
        background: #161f2c;
        border-radius: 1.2rem;
        padding: 1rem;
        margin-bottom: 0.8rem;
        border: 1px solid #2d3c50;
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .stat-icon {
        width: 40px;
        height: 40px;
        background: #1f3147;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
      }

      .stat-info h4 {
        font-size: 0.9rem;
        color: #b0c6e8;
        font-weight: 400;
      }

      .stat-info p {
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
        line-height: 1.2;
      }

      .doctor-list {
        background: #161f2c;
        border-radius: 1.2rem;
        padding: 1rem;
        border: 1px solid #2d3c50;
        max-height: 200px;
        overflow-y: auto;
      }

      .doctor-item {
        display: flex;
        justify-content: space-between;
        padding: 0.6rem 0;
        border-bottom: 1px solid #253141;
        font-size: 0.9rem;
      }

      .doctor-item:last-child {
        border-bottom: none;
      }

      .doctor-name {
        color: #b6ceff;
      }

      .doctor-count {
        background: #253e5e;
        padding: 0.2rem 0.8rem;
        border-radius: 2rem;
        font-weight: 600;
      }

      .sidebar-footer {
        margin-top: auto;
        padding-top: 1.5rem;
      }

      .logout-sidebar {
        width: 100%;
        padding: 0.9rem;
        background: #2a1f28;
        border: 1px solid #643a48;
        color: #f9c8d0;
        border-radius: 3rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: 0.2s;
      }

      .logout-sidebar:hover {
        background: #3f2c36;
      }

      /* Main content area */
      .main-content {
        flex: 1;
        padding: 1.5rem 2rem;
        transition: margin-left 0.3s;
        max-width: 100%;
      }

      /* Top bar with hamburger */
      .top-bar {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        margin-bottom: 2rem;
        background: #131a24;
        padding: 0.8rem 1.5rem;
        border-radius: 3rem;
        border: 1px solid #2d3c50;
      }

      .hamburger {
        background: #1f2a38;
        border: none;
        color: white;
        font-size: 1.8rem;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 1px solid #40536e;
        transition: 0.2s;
      }

      .hamburger:hover {
        background: #2c3b4f;
      }

      .page-title {
        font-size: 1.5rem;
        font-weight: 500;
        color: #d7e4ff;
      }

      .header-actions {
        margin-left: auto;
        display: flex;
        gap: 0.8rem;
      }

      /* main card ‚Äì fully responsive, dark glass */
      .container {
        max-width: 1400px;
        width: 100%;
        background: #13161c;
        border-radius: 2rem;
        padding: 2rem 1.8rem;
        box-shadow:
          0 25px 50px -12px rgba(0, 0, 0, 0.8),
          inset 0 1px 2px rgba(255, 255, 255, 0.05);
        border: 1px solid #2a2f3a;
        backdrop-filter: blur(2px);
      }

      /* header with icon + title */
      .app-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 2.2rem;
        flex-wrap: wrap;
      }
      .app-header .logo {
        background: #2271c2;
        width: 44px;
        height: 44px;
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 15px -5px #1e3a5f;
      }
      .app-header h1 {
        font-size: 1.9rem;
        font-weight: 600;
        letter-spacing: -0.02em;
        background: linear-gradient(135deg, #f0f4fa, #bdd3f0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .app-header .badge {
        margin-left: auto;
        background: #252b36;
        color: #9bb8f0;
        padding: 0.3rem 1rem;
        border-radius: 40px;
        font-size: 0.85rem;
        font-weight: 500;
        border: 1px solid #3f4a5a;
        white-space: nowrap;
      }

      /* auth forms (stacked) */
      .auth-card {
        background: #171d26;
        border-radius: 2rem;
        padding: 2rem 1.8rem;
        margin-bottom: 2.5rem;
        border: 1px solid #2a3440;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
      }
      .auth-tabs {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.8rem;
        border-bottom: 1px solid #2a333f;
        padding-bottom: 0.8rem;
      }
      .auth-tab {
        background: none;
        border: none;
        color: #93a5c2;
        font-size: 1.2rem;
        font-weight: 600;
        padding: 0.3rem 0.5rem;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: 0.15s;
      }
      .auth-tab.active {
        color: #a6c5f7;
        border-bottom: 3px solid #4a80d6;
      }
      .input-group {
        margin-bottom: 1.4rem;
      }
      .input-group label {
        display: block;
        font-size: 0.9rem;
        color: #a8b7cf;
        margin-bottom: 0.4rem;
        font-weight: 500;
      }
      .input-group input {
        width: 100%;
        background: #0f151e;
        border: 1.5px solid #2b3648;
        color: #f0f4fa;
        padding: 0.9rem 1.2rem;
        border-radius: 2rem;
        font-size: 1rem;
        outline: none;
        transition: 0.2s;
      }
      .input-group input:focus {
        border-color: #3f7ad0;
        box-shadow: 0 0 0 3px #1f3f6e;
      }
      .btn-primary {
        background: #2266c7;
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.9rem 1.8rem;
        border-radius: 3rem;
        font-size: 1rem;
        cursor: pointer;
        width: 100%;
        transition: 0.2s;
        border: 1px solid #4273c9;
        box-shadow: 0 8px 18px -8px #0f2b4b;
      }
      .btn-primary:hover {
        background: #2b6fd8;
        transform: scale(1.01);
      }
      .forgot-link {
        text-align: right;
        margin-top: 0.3rem;
      }
      .forgot-link button {
        background: none;
        border: none;
        color: #779be0;
        text-decoration: underline;
        font-size: 0.9rem;
        cursor: pointer;
      }
      .error-msg {
        color: #f8a8af;
        background: #3e2328;
        padding: 0.7rem 1.2rem;
        border-radius: 3rem;
        font-size: 0.9rem;
        margin: 0.5rem 0 1rem;
        border-left: 5px solid #bf4b5a;
      }
      .success-msg {
        color: #b1e6cc;
        background: #1f3f34;
        padding: 0.7rem 1.2rem;
        border-radius: 3rem;
        font-size: 0.9rem;
        border-left: 5px solid #2e9a76;
      }

      /* main app (authenticated) */
      .app-main {
        margin-top: 2rem;
      }
      .upload-panel {
        background: #161e28;
        border-radius: 2rem;
        padding: 1.8rem 1.5rem;
        margin-bottom: 2.5rem;
        border: 1px solid #2b3849;
      }
      .upload-panel h3 {
        font-size: 1.5rem;
        font-weight: 500;
        margin-bottom: 1.5rem;
        color: #d1e0fc;
      }
      .file-zone {
        border: 2px dashed #394a61;
        background: #0e151f;
        border-radius: 2rem;
        padding: 2rem 1rem;
        text-align: center;
        margin-bottom: 1.5rem;
        cursor: pointer;
        transition: 0.2s;
      }
      .file-zone:hover {
        border-color: #6183c0;
        background: #121b28;
      }
      .file-zone input {
        display: none;
      }
      .file-zone label {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.8rem;
        cursor: pointer;
      }
      .file-zone .icon {
        font-size: 2.8rem;
        filter: drop-shadow(0 4px 6px #111);
      }
      .inline-fields {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin: 1.5rem 0 1rem;
      }
      .inline-fields input {
        flex: 1 1 200px;
        background: #0f1621;
        border: 1.5px solid #2a384b;
        color: white;
        padding: 0.8rem 1.2rem;
        border-radius: 2rem;
        font-size: 0.95rem;
      }
      .btn-upload {
        background: #2e6b3e;
        border: none;
        color: white;
        padding: 0.9rem 1.8rem;
        border-radius: 3rem;
        font-weight: 600;
        font-size: 1rem;
        width: 100%;
        cursor: pointer;
        border: 1px solid #3d8f55;
        transition: 0.15s;
      }
      .btn-upload:hover {
        background: #3b824b;
      }

      /* Search and filter bar */
      .search-filter-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.5rem;
        align-items: center;
        background: #1a212b;
        padding: 1rem 1.5rem;
        border-radius: 3rem;
        border: 1px solid #2d3c50;
      }
      .search-box {
        flex: 2;
        min-width: 200px;
        position: relative;
      }
      .search-box input {
        width: 100%;
        background: #0f1621;
        border: 1.5px solid #2a384b;
        color: white;
        padding: 0.8rem 1.2rem 0.8rem 2.8rem;
        border-radius: 3rem;
        font-size: 0.95rem;
      }
      .search-box::before {
        content: 'üîç';
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1rem;
        opacity: 0.7;
      }
      .filter-group {
        display: flex;
        gap: 0.8rem;
        flex-wrap: wrap;
        flex: 3;
      }
      .filter-select {
        background: #0f1621;
        border: 1.5px solid #2a384b;
        color: white;
        padding: 0.8rem 1.2rem;
        border-radius: 3rem;
        font-size: 0.95rem;
        cursor: pointer;
        min-width: 140px;
      }
      .filter-select option {
        background: #1a222f;
      }
      .sort-badge {
        display: flex;
        align-items: center;
        gap: 0.3rem;
        background: #1f2a38;
        padding: 0.3rem 1rem;
        border-radius: 2rem;
        font-size: 0.9rem;
        cursor: pointer;
        border: 1px solid #40536e;
      }
      .sort-badge:hover {
        background: #2c3b4f;
      }

      /* prescription list */
      .list-header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.4rem;
      }
      .list-header h2 {
        font-weight: 500;
        color: #d2defc;
        font-size: 1.6rem;
      }
      .refresh-btn {
        background: #262f3d;
        border: 1px solid #41526b;
        color: #bbd1f0;
        padding: 0.5rem 1.5rem;
        border-radius: 3rem;
        font-weight: 500;
        cursor: pointer;
      }
      .prescriptions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.2rem;
      }
      .pres-card {
        background: #151e2a;
        border: 1px solid #2a3a50;
        border-radius: 2rem;
        padding: 1.3rem 1.2rem;
        transition: 0.1s;
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.6);
        display: flex;
        flex-direction: column;
      }
      .pres-card .filename {
        font-weight: 600;
        font-size: 1.1rem;
        color: #dee9ff;
        word-break: break-word;
        margin-bottom: 0.6rem;
      }
      .pres-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem 1.8rem;
        font-size: 0.9rem;
        color: #a0b5d3;
        margin: 0.5rem 0 0.8rem;
      }
      .pres-meta span strong {
        color: #c1d2f0;
      }
      .card-actions {
        display: flex;
        gap: 0.6rem;
        margin-top: 0.5rem;
        flex-wrap: wrap;
      }
      .btn-icon {
        background: #253040;
        border: none;
        color: #b8caf0;
        padding: 0.4rem 1rem;
        border-radius: 2rem;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        cursor: pointer;
        border: 1px solid #3e506a;
        flex: 1 0 auto;
        justify-content: center;
      }
      .btn-icon.delete {
        background: #311f25;
        color: #f9b7b7;
        border-color: #78454f;
      }
      .btn-icon.edit {
        background: #1e2f40;
        border-color: #38588b;
      }
      .edit-row {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin: 0.5rem 0;
      }
      .edit-row input {
        background: #0d1a24;
        border: 1px solid #325073;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 2rem;
      }

      /* reset password overlay inside container (modal style inline) */
      .reset-section {
        background: #171f2b;
        border-radius: 2rem;
        padding: 1.8rem;
        margin-top: 2rem;
        border: 1px solid #2e3f55;
      }

      /* responsive */
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 1000;
        }
        .main-content {
          padding: 1rem;
        }
        .top-bar {
          padding: 0.5rem 1rem;
        }
        .app-header h1 {
          font-size: 1.3rem;
        }
        .search-filter-bar {
          flex-direction: column;
          align-items: stretch;
        }
        .filter-group {
          flex-direction: column;
        }
      }

      @media (max-width: 500px) {
        .container {
          padding: 1.5rem 1rem;
        }
        .badge {
          display: none;
        }
        .prescriptions-grid {
          grid-template-columns: 1fr;
        }
      }

      /* utilities */
      .hidden {
        display: none !important;
      }
      .mt-2 {
        margin-top: 1rem;
      }
      .text-small {
        font-size: 0.85rem;
        color: #8599b5;
      }
      .flex {
        display: flex;
        gap: 0.8rem;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div class="app-wrapper">
      <!-- SIDEBAR (collapsible) -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-logo">üíä</div>
          <h2>MedPresc</h2>
        </div>

        <!-- User profile (dynamic) -->
        <div class="user-profile" id="sidebarUserProfile" style="display: none">
          <div class="user-avatar">üë®‚Äç‚öïÔ∏è</div>
          <div class="user-name" id="sidebarUserName"></div>
          <div class="user-email" id="sidebarUserEmail"></div>
        </div>

        <!-- Stats section (only visible when logged in) -->
        <div id="sidebarStats" style="display: none">
          <div class="stats-section">
            <div class="stats-title">üìä overview</div>
            <div class="stat-card">
              <div class="stat-icon">üìÑ</div>
              <div class="stat-info">
                <h4>total prescriptions</h4>
                <p id="totalFilesStat">0</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üë®‚Äç‚öïÔ∏è</div>
              <div class="stat-info">
                <h4>unique doctors</h4>
                <p id="uniqueDoctorsStat">0</p>
              </div>
            </div>
          </div>

          <div class="stats-section">
            <div class="stats-title">üìã doctors list</div>
            <div class="doctor-list" id="doctorListContainer">
              <!-- dynamically populated -->
              <div class="doctor-item">
                <span class="doctor-name">Loading...</span>
                <span class="doctor-count">-</span>
              </div>
            </div>
          </div>
        </div>

        <div class="sidebar-footer" id="sidebarFooter" style="display: none">
          <button class="logout-sidebar" id="sidebarLogoutBtn">
            <span>üö™</span> sign out
          </button>
        </div>

        <!-- Guest message in sidebar -->
        <div
          id="sidebarGuest"
          style="
            margin-top: 2rem;
            text-align: center;
            color: #7b92b5;
            display: block;
          "
        >
          <span>üîí login to access</span>
        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <div class="main-content">
        <!-- Top bar with hamburger -->
        <div class="top-bar">
          <button class="hamburger" id="hamburgerBtn">‚ò∞</button>
          <span class="page-title">Dashboard</span>
          <div class="header-actions">
            <!-- additional actions can go here -->
          </div>
        </div>

        <!-- main container (rest of the UI) -->
        <div class="container" id="appContainer">
          <!-- header -->
          <div class="app-header">
            <div class="logo">üíä</div>
            <h1>medpresc dark</h1>
            <div class="badge">secure ¬∑ gridfs</div>
          </div>

          <!-- AUTH CARD (login/signup/forgot/reset) -->
          <div id="authCard" class="auth-card">
            <div class="auth-tabs">
              <button class="auth-tab active" id="tabLogin">login</button>
              <button class="auth-tab" id="tabSignup">sign up</button>
            </div>

            <!-- login form -->
            <div id="loginForm">
              <div class="input-group">
                <label>üìß email</label>
                <input
                  type="email"
                  id="loginEmail"
                  placeholder="patient@example.com"
                />
              </div>
              <div class="input-group">
                <label>üîë password</label>
                <input
                  type="password"
                  id="loginPassword"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                />
              </div>
              <button class="btn-primary" id="loginBtn">log in</button>
              <div class="forgot-link">
                <button id="forgotPasswordBtn">forgot password?</button>
              </div>
            </div>

            <!-- signup form (hidden by default) -->
            <div id="signupForm" style="display: none">
              <div class="input-group">
                <label>üìß email</label>
                <input
                  type="email"
                  id="signupEmail"
                  placeholder="new@example.com"
                />
              </div>
              <div class="input-group">
                <label>üîë password</label>
                <input
                  type="password"
                  id="signupPassword"
                  placeholder="min 6 chars"
                />
              </div>
              <button class="btn-primary" id="signupBtn">create account</button>
            </div>

            <!-- forgot / reset inline (hidden) -->
            <div
              id="forgotContainer"
              style="display: none"
              class="reset-section"
            >
              <h4 style="margin-bottom: 1rem">üîê reset password</h4>
              <div id="stepEmail">
                <div class="input-group">
                  <label>email</label
                  ><input
                    type="email"
                    id="resetEmail"
                    placeholder="your email"
                  />
                </div>
                <button class="btn-primary" id="sendResetLink">
                  send reset link
                </button>
                <button class="btn-outline mt-2" id="backToLoginFromReset">
                  ‚Üê back
                </button>
              </div>
              <div id="stepToken" style="display: none">
                <div class="input-group">
                  <label>reset token</label
                  ><input
                    type="text"
                    id="tokenInput"
                    placeholder="paste token"
                  />
                </div>
                <div class="input-group">
                  <label>new password</label
                  ><input
                    type="password"
                    id="newPass"
                    placeholder="new password"
                  />
                </div>
                <div class="input-group">
                  <label>confirm</label
                  ><input
                    type="password"
                    id="confirmPass"
                    placeholder="confirm"
                  />
                </div>
                <button class="btn-primary" id="resetPassBtn">
                  set new password
                </button>
                <button class="btn-outline mt-2" id="backToEmail">
                  ‚Üê back
                </button>
              </div>
            </div>

            <!-- messages -->
            <div id="authMessage" class="error-msg hidden"></div>
            <div id="authSuccess" class="success-msg hidden"></div>
          </div>

          <!-- MAIN APP (authenticated) -->
          <div id="mainApp" class="app-main hidden">
            <!-- upload block -->
            <div class="upload-panel">
              <h3>üì§ upload prescription</h3>
              <div class="file-zone" id="fileDropZone">
                <input
                  type="file"
                  id="fileInput"
                  accept="image/*,application/pdf"
                />
                <label for="fileInput">
                  <span class="icon">üìÑ</span>
                  <span>tap to choose file (PDF/ image)</span>
                  <span class="text-small" id="selectedFileName"></span>
                </label>
              </div>
              <div class="inline-fields">
                <input
                  type="text"
                  id="doctorName"
                  placeholder="doctor name (optional)"
                />
                <input type="date" id="prescDate" />
              </div>
              <button class="btn-upload" id="uploadBtn">
                ‚¨Ü upload prescription
              </button>
            </div>

            <!-- Search and Filter Bar -->
            <div class="search-filter-bar" id="searchFilterBar">
              <div class="search-box">
                <input
                  type="text"
                  id="searchInput"
                  placeholder="Search by doctor or filename..."
                />
              </div>
              <div class="filter-group">
                <select class="filter-select" id="yearFilter">
                  <option value="all">All Years</option>
                </select>
                <select class="filter-select" id="sortSelect">
                  <option value="newest">Newest First</option>
                  <option value="oldest">Oldest First</option>
                  <option value="doctor-asc">Doctor (A-Z)</option>
                  <option value="doctor-desc">Doctor (Z-A)</option>
                  <option value="filename-asc">Filename (A-Z)</option>
                  <option value="filename-desc">Filename (Z-A)</option>
                </select>
                <div class="sort-badge" id="clearFiltersBtn">
                  <span>‚úï</span> Clear filters
                </div>
              </div>
            </div>

            <!-- prescriptions list -->
            <div class="list-header">
              <h2>üìã your prescriptions</h2>
              <button class="refresh-btn" id="refreshList">‚Üª refresh</button>
            </div>
            <div id="prescriptionsList" class="prescriptions-grid">
              <!-- dynamically loaded -->
            </div>
            <div
              id="emptyMessage"
              class="text-small"
              style="text-align: center; margin: 2rem"
            >
              no prescriptions yet. upload above.
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function () {
        // ------ config ------
        const API_BASE =
          window.location.hostname === 'localhost'
            ? 'http://localhost:3000'
            : 'https://medical-prescription-backend.vercel.app';
        const STORAGE_KEY = 'medPrescUser';

        // state
        let currentUser = null; // { id, email }
        let allFiles = []; // store files for stats
        let filteredFiles = []; // filtered and sorted files for display

        // DOM elements
        const authCard = document.getElementById('authCard');
        const mainApp = document.getElementById('mainApp');
        const tabLogin = document.getElementById('tabLogin');
        const tabSignup = document.getElementById('tabSignup');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const forgotContainer = document.getElementById('forgotContainer');
        const stepEmailDiv = document.getElementById('stepEmail');
        const stepTokenDiv = document.getElementById('stepToken');
        const authMessage = document.getElementById('authMessage');
        const authSuccess = document.getElementById('authSuccess');

        // inputs
        const loginEmail = document.getElementById('loginEmail');
        const loginPassword = document.getElementById('loginPassword');
        const signupEmail = document.getElementById('signupEmail');
        const signupPassword = document.getElementById('signupPassword');
        const resetEmail = document.getElementById('resetEmail');
        const tokenInput = document.getElementById('tokenInput');
        const newPass = document.getElementById('newPass');
        const confirmPass = document.getElementById('confirmPass');
        const fileInput = document.getElementById('fileInput');
        const selectedFileName = document.getElementById('selectedFileName');
        const doctorName = document.getElementById('doctorName');
        const prescDate = document.getElementById('prescDate');
        const prescriptionsDiv = document.getElementById('prescriptionsList');
        const emptyMsg = document.getElementById('emptyMessage');
        const refreshBtn = document.getElementById('refreshList');
        const uploadBtn = document.getElementById('uploadBtn');

        // Search and filter elements
        const searchInput = document.getElementById('searchInput');
        const yearFilter = document.getElementById('yearFilter');
        const sortSelect = document.getElementById('sortSelect');
        const clearFiltersBtn = document.getElementById('clearFiltersBtn');

        // Sidebar elements
        const sidebar = document.getElementById('sidebar');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sidebarUserProfile =
          document.getElementById('sidebarUserProfile');
        const sidebarUserName = document.getElementById('sidebarUserName');
        const sidebarUserEmail = document.getElementById('sidebarUserEmail');
        const sidebarStats = document.getElementById('sidebarStats');
        const sidebarFooter = document.getElementById('sidebarFooter');
        const sidebarGuest = document.getElementById('sidebarGuest');
        const sidebarLogoutBtn = document.getElementById('sidebarLogoutBtn');
        const totalFilesStat = document.getElementById('totalFilesStat');
        const uniqueDoctorsStat = document.getElementById('uniqueDoctorsStat');
        const doctorListContainer = document.getElementById(
          'doctorListContainer',
        );

        // Load user from localStorage on page load
        function loadUserFromStorage() {
          const stored = localStorage.getItem(STORAGE_KEY);
          if (stored) {
            try {
              currentUser = JSON.parse(stored);
            } catch (e) {
              console.error('Failed to parse stored user', e);
              localStorage.removeItem(STORAGE_KEY);
            }
          }
        }

        // Save user to localStorage
        function saveUserToStorage(user) {
          if (user) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(user));
          } else {
            localStorage.removeItem(STORAGE_KEY);
          }
        }

        // Hamburger toggle
        hamburgerBtn.addEventListener('click', () => {
          sidebar.classList.toggle('collapsed');
        });

        // Close sidebar on mobile when clicking outside (optional)
        document.addEventListener('click', (e) => {
          if (window.innerWidth <= 768) {
            if (
              !sidebar.contains(e.target) &&
              !hamburgerBtn.contains(e.target)
            ) {
              sidebar.classList.add('collapsed');
            }
          }
        });

        // Helper: show/hide messages
        function setAuthError(msg) {
          if (msg) {
            authMessage.innerText = msg;
            authMessage.classList.remove('hidden');
            authSuccess.classList.add('hidden');
          } else {
            authMessage.classList.add('hidden');
          }
        }
        function setAuthSuccess(msg) {
          if (msg) {
            authSuccess.innerText = msg;
            authSuccess.classList.remove('hidden');
            authMessage.classList.add('hidden');
          } else {
            authSuccess.classList.add('hidden');
          }
        }

        // Update sidebar stats
        function updateSidebarStats() {
          if (!currentUser || allFiles.length === 0) {
            totalFilesStat.innerText = allFiles.length;
            uniqueDoctorsStat.innerText = '0';
            doctorListContainer.innerHTML =
              '<div class="doctor-item"><span class="doctor-name">No data</span><span class="doctor-count">-</span></div>';
            return;
          }

          // Total files
          totalFilesStat.innerText = allFiles.length;

          // Count by doctor
          const doctorCounts = {};
          allFiles.forEach((f) => {
            const doc = f.doctor || 'Unknown';
            doctorCounts[doc] = (doctorCounts[doc] || 0) + 1;
          });

          uniqueDoctorsStat.innerText = Object.keys(doctorCounts).length;

          // Build doctor list
          const sortedDocs = Object.entries(doctorCounts).sort(
            (a, b) => b[1] - a[1],
          );
          doctorListContainer.innerHTML = sortedDocs
            .map(
              ([doc, count]) => `
              <div class="doctor-item">
                <span class="doctor-name">${doc}</span>
                <span class="doctor-count">${count}</span>
              </div>
            `,
            )
            .join('');

          if (sortedDocs.length === 0) {
            doctorListContainer.innerHTML =
              '<div class="doctor-item"><span class="doctor-name">No doctors</span><span class="doctor-count">-</span></div>';
          }
        }

        // Filter and sort functions
        function updateYearFilterOptions() {
          const years = new Set();
          allFiles.forEach((file) => {
            if (file.date) {
              const year = file.date.split('-')[0];
              years.add(year);
            }
          });

          const sortedYears = Array.from(years).sort((a, b) => b - a);
          yearFilter.innerHTML =
            '<option value="all">All Years</option>' +
            sortedYears
              .map((year) => `<option value="${year}">${year}</option>`)
              .join('');
        }

        function filterAndSortFiles() {
          if (!allFiles.length) {
            filteredFiles = [];
            return;
          }

          // Apply search filter
          const searchTerm = searchInput.value.toLowerCase();
          let filtered = allFiles.filter((file) => {
            const matchesSearch =
              (file.doctor && file.doctor.toLowerCase().includes(searchTerm)) ||
              (file.filename &&
                file.filename.toLowerCase().includes(searchTerm));
            return matchesSearch;
          });

          // Apply year filter
          const selectedYear = yearFilter.value;
          if (selectedYear !== 'all') {
            filtered = filtered.filter(
              (file) => file.date && file.date.startsWith(selectedYear),
            );
          }

          // Apply sorting
          const sortOption = sortSelect.value;
          filtered.sort((a, b) => {
            switch (sortOption) {
              case 'newest':
                return (b.date || '').localeCompare(a.date || '');
              case 'oldest':
                return (a.date || '').localeCompare(b.date || '');
              case 'doctor-asc':
                return (a.doctor || '').localeCompare(b.doctor || '');
              case 'doctor-desc':
                return (b.doctor || '').localeCompare(a.doctor || '');
              case 'filename-asc':
                return (a.filename || '').localeCompare(b.filename || '');
              case 'filename-desc':
                return (b.filename || '').localeCompare(a.filename || '');
              default:
                return 0;
            }
          });

          filteredFiles = filtered;
        }

        function renderPrescriptions() {
          filterAndSortFiles();

          if (filteredFiles.length === 0) {
            prescriptionsDiv.innerHTML = '';
            emptyMsg.style.display = 'block';
            return;
          }

          emptyMsg.style.display = 'none';
          prescriptionsDiv.innerHTML = filteredFiles
            .map(
              (f) => `
              <div class="pres-card" data-id="${f.id}">
                <div class="filename">üìÑ ${f.filename}</div>
                <div class="pres-meta">
                  <span><strong>üë®‚Äç‚öïÔ∏è</strong> ${f.doctor || '‚Äî'}</span>
                  <span><strong>üìÖ</strong> ${f.date || '‚Äî'}</span>
                </div>
                <div class="card-actions">
                  <button class="btn-icon view-btn" data-metaid="${f.id}">üëÅ view</button>
                  <button class="btn-icon edit" data-metaid="${f.id}">‚úé edit</button>
                  <button class="btn-icon delete" data-metaid="${f.id}">‚úï delete</button>
                </div>
                <div class="edit-row hidden" id="edit-${f.id}">
                  <input type="text" id="edit-doctor-${f.id}" placeholder="doctor" value="${f.doctor || ''}">
                  <input type="date" id="edit-date-${f.id}" value="${f.date || ''}">
                  <div class="flex">
                    <button class="btn-icon save-edit" data-id="${f.id}">save</button>
                    <button class="btn-icon cancel-edit" data-id="${f.id}">cancel</button>
                  </div>
                </div>
              </div>
            `,
            )
            .join('');
        }

        // render UI based on currentUser
        function refreshUI() {
          const loggedIn = !!currentUser;
          if (loggedIn) {
            authCard.classList.add('hidden');
            mainApp.classList.remove('hidden');
            // sidebar
            sidebarUserProfile.style.display = 'block';
            sidebarStats.style.display = 'block';
            sidebarFooter.style.display = 'block';
            sidebarGuest.style.display = 'none';
            sidebarUserName.innerText = currentUser.email.split('@')[0];
            sidebarUserEmail.innerText = currentUser.email;
            loadPrescriptions();
          } else {
            authCard.classList.remove('hidden');
            mainApp.classList.add('hidden');
            sidebarUserProfile.style.display = 'none';
            sidebarStats.style.display = 'none';
            sidebarFooter.style.display = 'none';
            sidebarGuest.style.display = 'block';
            // default to login tab
            showLoginTab();
            setAuthError(null);
            setAuthSuccess(null);
            allFiles = [];
            filteredFiles = [];
            updateSidebarStats();
          }
        }

        // tab switching
        function showLoginTab() {
          tabLogin.classList.add('active');
          tabSignup.classList.remove('active');
          loginForm.style.display = 'block';
          signupForm.style.display = 'none';
          forgotContainer.style.display = 'none';
          setAuthError(null);
        }
        function showSignupTab() {
          tabSignup.classList.add('active');
          tabLogin.classList.remove('active');
          loginForm.style.display = 'none';
          signupForm.style.display = 'block';
          forgotContainer.style.display = 'none';
          setAuthError(null);
        }
        tabLogin.addEventListener('click', showLoginTab);
        tabSignup.addEventListener('click', showSignupTab);

        // Forgot flow
        document
          .getElementById('forgotPasswordBtn')
          .addEventListener('click', () => {
            loginForm.style.display = 'none';
            signupForm.style.display = 'none';
            forgotContainer.style.display = 'block';
            stepEmailDiv.style.display = 'block';
            stepTokenDiv.style.display = 'none';
            setAuthError(null);
          });
        document
          .getElementById('backToLoginFromReset')
          .addEventListener('click', () => {
            forgotContainer.style.display = 'none';
            loginForm.style.display = 'block';
          });
        document.getElementById('backToEmail').addEventListener('click', () => {
          stepTokenDiv.style.display = 'none';
          stepEmailDiv.style.display = 'block';
        });
        document
          .getElementById('sendResetLink')
          .addEventListener('click', async () => {
            const email = resetEmail.value.trim();
            if (!email) return setAuthError('enter email');
            setAuthError(null);
            try {
              const res = await fetch(`${API_BASE}/auth/forgot-password`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email }),
              });
              const data = await res.json();
              if (!res.ok) throw new Error(data.error || 'request failed');
              setAuthSuccess(
                'reset link generated (check console / demo token)',
              );
              if (data.resetLink) {
                const urlParams = new URLSearchParams(
                  data.resetLink.split('?')[1],
                );
                const token = urlParams.get('token');
                if (token) {
                  stepEmailDiv.style.display = 'none';
                  stepTokenDiv.style.display = 'block';
                  tokenInput.value = token;
                }
              }
            } catch (e) {
              setAuthError(e.message);
            }
          });

        document
          .getElementById('resetPassBtn')
          .addEventListener('click', async () => {
            const token = tokenInput.value.trim();
            const pwd = newPass.value;
            const conf = confirmPass.value;
            if (!token || !pwd || !conf) return setAuthError('fill all fields');
            if (pwd !== conf) return setAuthError('passwords mismatch');
            try {
              const res = await fetch(`${API_BASE}/auth/reset-password`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  token,
                  password: pwd,
                  confirmPassword: conf,
                }),
              });
              const data = await res.json();
              if (!res.ok) throw new Error(data.error || 'reset failed');
              setAuthSuccess('password updated! please login');
              setTimeout(() => {
                forgotContainer.style.display = 'none';
                loginForm.style.display = 'block';
                stepEmailDiv.style.display = 'block';
                stepTokenDiv.style.display = 'none';
              }, 1500);
            } catch (e) {
              setAuthError(e.message);
            }
          });

        // login
        document
          .getElementById('loginBtn')
          .addEventListener('click', async () => {
            const email = loginEmail.value.trim();
            const pass = loginPassword.value;
            if (!email || !pass) return setAuthError('enter credentials');
            try {
              const res = await fetch(`${API_BASE}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password: pass }),
              });
              const data = await res.json();
              if (!res.ok) throw new Error(data.error || 'login failed');
              currentUser = { id: data.id, email: data.email };
              saveUserToStorage(currentUser);
              refreshUI();
            } catch (e) {
              setAuthError(e.message);
            }
          });

        // signup
        document
          .getElementById('signupBtn')
          .addEventListener('click', async () => {
            const email = signupEmail.value.trim();
            const pass = signupPassword.value;
            if (!email || !pass) return setAuthError('email & password');
            try {
              const res = await fetch(`${API_BASE}/auth/signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password: pass }),
              });
              const data = await res.json();
              if (!res.ok) throw new Error(data.error || 'signup failed');
              setAuthSuccess('account created! please login.');
              showLoginTab();
              loginEmail.value = email;
            } catch (e) {
              setAuthError(e.message);
            }
          });

        // logout (both buttons)
        function logout() {
          currentUser = null;
          saveUserToStorage(null);
          refreshUI();
        }
        sidebarLogoutBtn.addEventListener('click', logout);

        // file upload
        fileInput.addEventListener('change', () => {
          selectedFileName.innerText = fileInput.files[0]?.name || '';
        });
        document
          .getElementById('fileDropZone')
          .addEventListener('click', () => fileInput.click());

        uploadBtn.addEventListener('click', async () => {
          if (!currentUser) return;
          const file = fileInput.files[0];
          if (!file) return alert('select a file');
          const doctor = doctorName.value.trim() || 'Unknown';
          const date =
            prescDate.value || new Date().toISOString().split('T')[0];

          const formData = new FormData();
          formData.append('file', file);
          formData.append('userId', currentUser.id);
          formData.append('doctor', doctor);
          formData.append('date', date);

          try {
            const res = await fetch(`${API_BASE}/upload`, {
              method: 'POST',
              body: formData,
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || 'upload error');
            alert('upload successful');
            fileInput.value = '';
            selectedFileName.innerText = '';
            doctorName.value = '';
            prescDate.value = '';
            loadPrescriptions();
          } catch (e) {
            alert('upload failed: ' + e.message);
          }
        });

        // load prescriptions
        async function loadPrescriptions() {
          if (!currentUser) return;
          try {
            const res = await fetch(
              `${API_BASE}/files?userId=${currentUser.id}`,
            );
            if (!res.ok) throw new Error('failed to fetch');
            const files = await res.json();
            allFiles = files;
            updateYearFilterOptions();
            updateSidebarStats();
            renderPrescriptions();
          } catch (e) {
            console.error(e);
          }
        }

        // Event listeners for search and filter
        searchInput.addEventListener('input', renderPrescriptions);
        yearFilter.addEventListener('change', renderPrescriptions);
        sortSelect.addEventListener('change', renderPrescriptions);
        clearFiltersBtn.addEventListener('click', () => {
          searchInput.value = '';
          yearFilter.value = 'all';
          sortSelect.value = 'newest';
          renderPrescriptions();
        });

        // handle view, edit, delete (delegation)
        prescriptionsDiv.addEventListener('click', async (e) => {
          const target = e.target;
          if (!currentUser) return;
          const metaId = target.dataset.metaid;
          if (target.classList.contains('view-btn') && metaId) {
            window.open(`${API_BASE}/file/${metaId}`, '_blank');
          }
          if (target.classList.contains('delete') && metaId) {
            if (!confirm('delete prescription?')) return;
            try {
              const res = await fetch(`${API_BASE}/file/${metaId}`, {
                method: 'DELETE',
              });
              if (!res.ok) throw new Error();
              loadPrescriptions();
            } catch {
              alert('delete failed');
            }
          }
          if (target.classList.contains('edit') && metaId) {
            document
              .getElementById(`edit-${metaId}`)
              .classList.toggle('hidden');
          }
          if (target.classList.contains('cancel-edit')) {
            const id = target.dataset.id;
            document.getElementById(`edit-${id}`).classList.add('hidden');
          }
          if (target.classList.contains('save-edit')) {
            const id = target.dataset.id;
            const doctor = document.getElementById(`edit-doctor-${id}`).value;
            const date = document.getElementById(`edit-date-${id}`).value;
            try {
              const res = await fetch(`${API_BASE}/file/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ doctor, date }),
              });
              if (!res.ok) throw new Error();
              document.getElementById(`edit-${id}`).classList.add('hidden');
              loadPrescriptions();
            } catch {
              alert('edit failed');
            }
          }
        });

        refreshBtn.addEventListener('click', loadPrescriptions);

        // Initialize: load user from storage first
        loadUserFromStorage();

        // initial UI render
        refreshUI();

        // set today's date as default for date picker
        const today = new Date().toISOString().split('T')[0];
        if (prescDate) prescDate.value = today;
      })();
    </script>
  </body>
</html>
